<html>
    <head>
        <title>watchface</title>
        <link rel="stylesheet" href="bootstrap.min.css">
        <style type="text/css">
            body
            {
                text-align:center;
            }
			hiview
			{
                text-align:left;
                display:inline-block;
                outline:none;
			}

            #simpleWatch { background-image: url(watchfaceBg.png); }
        </style>
    </head>
    <body>
        <hiview type="watchface" design="default" vendor="fmsoft.cn"
            id="simpleWatch" width="520" height="520"
            data-move="static" data-time="9:45:03"
            onhandsmoved="viewHandMoved(event)"
            onhourmoved="viewHourMoved(event)"
            onminutemoved="viewMinuteMoved(event)"
            onsecondmoved="viewSecondMoved(event)"
            >
            <param name="hands" value="hour,minute,second" />
        </hiview>

        <div class="container">
            <div class="row">
                <div class="col alert alert-primary" role="alert" id="statusInfo">
                </div>
                <div class="col alert alert-primary" id="paramStatus">
                </div>
            </div>
        </div>

        <button id="btnStart" type="button" class="btn btn-primary">Start</button>
        <button id="btnStop" type="button"  class="btn btn-primary">Stop</button>

        <script type="text/javascript">
            var watch = document.getElementById("simpleWatch");

            function updateStatus()
            {
                document.getElementById("statusInfo").innerText = "data-move: " + watch.dataset.move + " | data-time: " + watch.dataset.time;
            }
            function startMove()
            {
                watch.dataset.move = 'auto';
                updateStatus();
            }

            function stopMove()
            {
                watch.dataset.move = 'static';
                updateStatus();
            }
            function dateFormat(fmt, date) {
                let ret;
                let opt = {
                    "Y+": date.getFullYear().toString(),        // 年
                    "m+": (date.getMonth() + 1).toString(),     // 月
                    "d+": date.getDate().toString(),            // 日
                    "H+": date.getHours().toString(),           // 时
                    "M+": date.getMinutes().toString(),         // 分
                    "S+": date.getSeconds().toString()          // 秒
                };
                for (let k in opt) {
                    ret = new RegExp("(" + k + ")").exec(fmt);
                    if (ret) {
                        fmt=fmt.replace(ret[1],(ret[1].length==1)?(opt[k]):(opt[k].padStart(ret[1].length,"0")))
                    };
                };
                return fmt;
            }

            function viewHandMoved(event)
            {
                document.getElementById("paramStatus").innerText = dateFormat("YYYY-mm-dd HH:MM:SS", new Date())  +  ": onhandsmoved:" + event.hands;
            }

            function viewHourMoved()
            {
                document.getElementById("paramStatus").innerText =  dateFormat("YYYY-mm-dd HH:MM:SS", new Date())  + " : onhourmoved ";
            }

            function viewSecondMoved()
            {
                document.getElementById("paramStatus").innerText =  dateFormat("YYYY-mm-dd HH:MM:SS", new Date())  + " : onsecondmoved ";
            }

            function viewMinuteMoved()
            {
                document.getElementById("paramStatus").innerText =  dateFormat("YYYY-mm-dd HH:MM:SS", new Date())  + " : onminutemoved ";
            }

            var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver
            var observer = new MutationObserver(function(mutations) {
                updateStatus();
            });
            var config = { attributes: true, childList: true, characterData: true }
            observer.observe(watch, config);
            updateStatus();
            document.getElementById("btnStart").onclick = startMove;
            document.getElementById("btnStop").onclick = stopMove;
        </script>
    </body>
</html>
